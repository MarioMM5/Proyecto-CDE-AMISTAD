const productos = {
  413844533: {
    nombre: "Camiseta Oficial",
    precio: 25.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: ["../img/camiseta.png", "../img/camiseta_2.png"],
    info: `
    <strong>Camisetas con diseño exclusivo para el CDE Amistad</strong><br><br>

    Verdes con bordeados blancos.<br><br>

    <strong>Personalización individual:</strong> talla, nombre, dorsal.<br><br>

    Hechas con poliéster muy cómodas y resistibles para poder jugar a buen rendimiento.<br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor, tenga en cuenta el siguiente documento para elegir correctamente la talla: 
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank" style="color: #007bff; text-decoration: underline;">ver guía de tallas</a>.<br><br>

    El artículo tarda alrededor de 3 semanas desde que se realiza el pedido.
  `,
  },
  413844534: {
    nombre: "Sudadera del Equipo",
    precio: 25.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: [
      "../img/sudadera.jpg",
      "../img/sudadera_2.jpg",
      "../img/tallas_sudadera.jpg",
    ],
    info: `
    <strong>Marca:</strong> Gañafote<br><br>
    Sudadera diseñada en exclusiva para el <strong>C.D.E. Amistad</strong> en color verde con detalles en blanco.<br><br>
    
    Fabricada en un <strong>tejido ligero</strong> para garantizar la comodidad del futbolista durante la práctica deportiva.<br><br>
    
    La impresión se ha realizado mediante la técnica de <strong>sublimación</strong>, que permite que el estampado quede totalmente integrado en el tejido. No se nota al tacto, ni se rompe ni pierde color con el tiempo.<br><br>
    
    Las prendas son fabricadas bajo pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Consulta el siguiente documento para elegir correctamente la talla:
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank" style="color: #007bff; text-decoration: underline;">ver guía de tallas</a>.<br><br>

    El artículo tarda aproximadamente <strong>3 semanas</strong> desde que se realiza el pedido.
  `,
  },
  413844535: {
    nombre: "Abrigo del Equipo",
    precio: 36.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: [
      "../img/abrigo.jpg",
      "../img/abrigo_2.jpg",
      "../img/abrigo_3.jpg",
      "../img/tallas_abrigo.jpg",
    ],
    info: `
    <strong>Abrigo color negro fabricado en Poliéster</strong>.<br><br>
    <strong>Especificaciones:</strong><br>
    • Muy ligero y compacto<br>
    • Gran comodidad térmica<br>
    • Cremallera en bolsillos<br>
    • Capucha<br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor, tenga en cuenta el siguiente documento para elegir correctamente la talla: 
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank" style="color: #007bff; text-decoration: underline;">ver guía de tallas</a>.<br><br>

    El artículo tarda alrededor de 3 semanas desde que se realiza el pedido.
  `,
  },
  413844536: {
    nombre: "Chubasquero del Equipo",
    precio: 18.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: [
      "../img/chubasquero.jpg",
      "../img/chubasquero_2.jpg",
      "../img/chubasquero_3.jpg",
      "../img/chubasquero_4.jpg",
      "../img/chubasquero_5.jpg",
      "../img/tallas_abrigo.jpg",
    ],
    info: `
    <strong>Marca:</strong> Gañafote<br><br>
    
    Chubasquero en color negro fabricado en <strong>Poliéster</strong>, con las siguientes especificaciones:<br><br>

    - Cremallera principal <strong>reflectante</strong><br>
    - Bolsillos con cremallera <strong>reflectante</strong><br>
    - Capucha con tela <strong>transpirable</strong><br>
    - Bolsillo posterior para <strong>guardar el chubasquero</strong><br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor, tenga en cuenta el siguiente documento para elegir correctamente la talla:<br>
    
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank" style="color: #007bff; text-decoration: underline;">ver guía de tallas</a>.<br><br>

    El artículo tarda aproximadamente <strong>3 semanas</strong> desde que se realiza el pedido.
  `,
  },
  413844537: {
    nombre: "Mochila del Equipo",
    precio: 18.0,
    tallas: [], 
    imagen: [
      "../img/mochila.jpg",
      "../img/mochila_2.jpg",
      "../img/mochila_3.jpg",
    ],
    info: `
    Mochila de color <strong>negro</strong> fabricada en <strong>poliéster</strong>, diseñada para resistir las batallas del día a día con estilo y funcionalidad:<br><br>

    - Bolsillo principal de <strong>gran capacidad</strong><br>
    - Bolsillo exterior con <strong>red interior</strong> para pequeños objetos<br>
    - Bolsillo <strong>zapatero acolchado</strong> en la parte inferior<br>
    - <strong>Acolchado en la espalda</strong> y <strong>asas anchas</strong> para mayor comodidad en todo momento
  `,
  },
  413844538: {
    nombre: "Chandal Oficial",
    precio: 45.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: [
      "../img/chandal.jpg",
      "../img/chandal_2.jpg",
      "../img/chandal_3.jpg",
      "../img/tallas.jpg",
    ],
    info: `
    <strong>El chándal del C.D.E. Amistad</strong> se compone de chaqueta y pantalón.<br><br>

    La chaqueta ha sido diseñada en exclusiva para el C.D.E. Amistad en color verde con detalles en blanco. Chaqueta abierta con cremallera, gorro y bolsillos con cremallera. Cuenta con un ribs en los puños de color negro para un ajuste óptimo.<br>
    <strong>Composición:</strong> 100% poliéster.<br><br>

    El pantalón es 100% poliéster en color negro con el escudo del club bordado en blanco.<br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor, tenga en cuenta el siguiente documento para elegir correctamente la talla: 
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank" style="color: #007bff; text-decoration: underline;">ver guía de tallas</a>.<br><br>

    El artículo tarda alrededor de 3 semanas desde que se realiza el pedido.
  `,
  },
  413844539: {
    nombre: "Conjunto del Equipo",
    precio: 30.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    medias: ["NO", "25-28", "29-32", "33-36", "27-40", "41-44"],
    imagen: [
      "../img/conjunto_entero.jpg",
      "../img/conjunto_entero_2.jpg",
      "../img/calcetines.jpg",
      "../img/tallas_conjunto.jpg",
    ],
    info: `
    <strong>Marca:</strong> Gañafote<br><br>
    El Conjunto de entrenamiento del C.D.E. Amistad está compuesto por camiseta, pantalón y medias (opcional).<br><br>

    La camiseta y el pantalón han sido diseñados en exclusiva para el C.D.E. Amistad a través de la técnica de sublimación. 
    La principal ventaja de esta técnica para el diseño de camisetas deportivas es que el estampado está completamente 
    impregnado en la camiseta hasta que forma parte de la tela misma. No se nota al tacto, ni puedes percibir ninguna aspereza, 
    no se rompe ni pierde matiz con el tiempo.<br><br>

    Fabricado en un tejido ligero, transpirable y resistente ideal para la práctica deportiva.<br><br>

    <strong>Color camiseta y pantalón:</strong> Verde con detalles en blanco<br>
    <strong>Color medias:</strong> Blanco<br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor, tenga en cuenta el siguiente documento para elegir correctamente la talla: 
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank" style="color: #007bff; text-decoration: underline;">ver guía de tallas</a>.<br><br>

    El artículo tarda alrededor de 3 semanas desde que se realiza el pedido.
  `,
  },
  413844520: {
    nombre: "Medias del Equipo",
    precio: 6.5,
    tallas: ["25-28", "29-32", "33-36", "27-40", "41-44"],
    imagen: [
      "../img/calcetines.jpg",
      "../img/calcetines_2.jpg",
      "../img/calcetines_3.jpg",
      "../img/calcetines_4.jpg",
    ],
    info: `
    <strong>Medias personalizadas C.D.E. Amistad</strong><br><br>

    <strong>Medias blancas:</strong> Entrenamiento<br>
    <strong>Medias negras:</strong> Partido<br><br>

    Diseño personalizado con el escudo y nombre del Club en verde.<br><br>

    Con forma cómoda para un mejor ajuste en la parte superior y en el tobillo.
  `,
  },
  413844521: {
    nombre: "Polo del Equipo",
    precio: 25.0,
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: ["../img/polo.jpg", "../img/polo_2.jpg", "../img/tallas_polo.jpg"],
    info: `
    <strong>Marca:</strong> Gañafote<br><br>
    Polo diseñado en <strong>exclusiva</strong> para el <strong>C.D.E. Amistad</strong>.<br><br>

    - Color <strong>verde</strong> con detalles en <strong>blanco y negro</strong><br>
    - Fabricado con <strong>técnica de sublimación</strong>: el estampado está completamente integrado en la tela. No se nota al tacto, no se rompe ni pierde intensidad con el tiempo.<br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor, tenga en cuenta el siguiente documento para elegir correctamente la talla: 
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank">Guía de tallas</a>.<br><br>
    
    El artículo tarda alrededor de <strong>3 semanas</strong> desde que se realiza el pedido.
  `,
  },
  413844522: {
    nombre: "Pack del Equipo",
    precio: 200.0,
    medias: ["25-28", "29-32", "33-36", "27-40", "41-44"],
    tallas: ["4", "6", "8", "10", "12", "14", "XS", "S", "M", "L", "XL", "XXL"],
    imagen: [
      "../img/pack.jpg",
      "../img/conjunto_entero.jpg",
      "../img/camiseta.png",
      "../img/chandal.jpg",
      "../img/abrigo.jpg",
      "../img/chubasquero.jpg",
      "../img/mochila.jpg",
    ],
    opciones: ["SI (+35.00€)", "NO"],
    info: `
    <strong>Marca:</strong> Gañafote<br><br>
    Con el pack de ropa de entrenamiento del <strong>C.D.E. Amistad</strong> tendrás todas las prendas necesarias para desarrollar la actividad a un precio más económico.<br><br>

    Las prendas son fabricadas según se realiza el pedido, por lo que <strong>NO se aceptan cambios de talla</strong>. Por favor tenga en cuenta el siguiente documento para elegir correctamente la talla: 
    <a href="https://cdeamistad.com/wp-content/uploads/2022/09/Medidas-Ropa-cdeamistad-2022.pdf" target="_blank">Guía de tallas</a>.<br><br>

    El artículo tarda alrededor de <strong>3 semanas</strong> desde que se realiza el pedido.<br><br>

    <strong>El pack contiene:</strong><br>
    - Conjunto de entrenamiento (Camiseta, pantalón y medias)<br>
    - Sudadera<br>
    - Chandal (Chaqueta y pantalón)<br>
    - Chubasquero<br>
    - Abrigo<br>
    - Mochila<br><br>

    <em>*Los alumnos nuevos en la temporada 2024/2025 deberán marcar la casilla "Ropa de Juego": camiseta, pantalón y medias.</em>
  `,
  },
};

const params = new URLSearchParams(window.location.search);
const productId = params.get("id");
const container = document.getElementById("product-detail");
function obtenerRecomendados(idActual, productos, cantidad = 3) {
  const otrosProductos = Object.entries(productos)
    .filter(([id]) => id !== idActual)
    .slice(0, cantidad);

  return otrosProductos
    .map(
      ([id, prod]) => `
    <div class="recommended-card">
      <a href="detalle-producto.html?id=${id}" title="${prod.nombre}">
        <div class="img-wrapper">
          <img src="${prod.imagen[0]}" alt="${prod.nombre}" />
        </div>
        <p class="recommended-title">${prod.nombre}</p>
      </a>
    </div>
  `
    )
    .join("");
}
if (!productId || !productos[productId]) {
  container.innerHTML = `<p class="error">Producto no encontrado.</p>`;
} else {
  const p = productos[productId];
  const esCamiseta = productId === "413844533";
  const esConjunto = productId === "413844539";
  const esPack = productId === "413844522";

  const tallasButtons = p.tallas
    .map(
      (t) => `
    <button type="button" class="option-button size-option" data-value="${t}">${t}</button>
  `
    )
    .join("");

  let optionsButtons = "";
  if (productId === "413844522") {
    optionsButtons = p.opciones
      .map(
        (t) => `
    <button type="button" class="option-button size-option" data-value="${t}">${t}</button>
  `
      )
      .join("");
  }

  let mediasButtons = "";
  if (productId === "413844539" || productId === "413844522") {
    mediasButtons = p.medias
      .map(
        (t) => `
    <button type="button" class="option-button size-option" data-value="${t}">${t}</button>
  `
      )
      .join("");
  }
  function render(label, buttons, id = "siu") {
    return buttons.length
      ? `
        <label style="font-weight: bold;">${label}:</label>
        <div class="option-group" id=${id} style="display: flex; gap: 10px;">
          ${buttons}
        </div>
      `
      : "";
  }

  container.innerHTML = `
<a href="mercha.html" class="back-link">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
  </svg>
  Volver atrás
</a>

<div class="product-detail-container">
 <div style="flex:1;display:flex;flex-direction:column;align-items:center; position: relative;">
  <img src="${p.imagen[0]}" alt="${
    p.nombre
  }" class="product-image" id="carousel-image" />
  
  <button id="prev-btn" style="position:absolute; top:25%; left:0px; transform: translateY(-50%); font-size:2rem; background:none; border:none; color:#2ecc71; cursor:pointer;">&#10094;</button>
  <button id="next-btn" style="position:absolute; top:25%; right:0px; transform: translateY(-50%); font-size:2rem; background:none; border:none; color:#2ecc71; cursor:pointer;">&#10095;</button>
  
  <div id="otrasImagenes" class="photos-card" style="margin-top: 1rem;"></div>

  <div class="product-info-box">
    <h3 style="margin:0 0 0.5rem;font-size:1.1rem;color:#222;">ℹ️ Información del producto</h3>
    <p style="margin:0;">${p.info || ""}</p>
  </div>
</div>

  <form id="product-options-form">
    <div class="product-title-box">
      <h2>${p.nombre}</h2>
      <p>${p.precio || ""}€</p>
    </div>

    ${!esPack ? render("Talla", tallasButtons, "size-options") : ""}
    ${
      esCamiseta
        ? `
      <div>
        <label for="name-input" style="display:block;font-weight:bold;margin-bottom:0.3rem;">Nombre (opcional):</label>
        <input type="text" id="name-input" name="name" placeholder="Ej: Gutiérrez" />
      </div>
      <label for="number-input">Dorsal (opcional):</label>
      <input type="number" id="number-input" name="dorsal" min="1" placeholder="Número" />
    `
        : ""
    }

    ${esConjunto ? render("Medias", mediasButtons, "medias") : ""}

    ${
      esPack
        ? `
      ${render("Conjunto de equipo", tallasButtons, "conjunto")}
      ${render("Sudadera", tallasButtons, "sudadera")}
      ${render("Chandal", tallasButtons, "chandal")}
      ${render("Abrigo", tallasButtons, "abrigo")}
      ${render("Chubasquero", tallasButtons, "chubasquero")}
      ${render("Medias", mediasButtons, "medias")}
      ${render(
        "Ropa de juego (Obligatoria nuevos alumnos)",
        optionsButtons,
        "ropa-juego"
      )}
    `
        : ""
    }

    <label for="quantity-input" style="font-weight:bold;">Cantidad:</label>
    <input type="number" id="quantity-input" name="quantity" value="1" min="1" required />

    <button type="submit" class="add-cart-btn">Añadir al carrito</button>
<div id="message-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

    <div class="recommended-section">
      <h3>Productos Relacionados</h3>
      <div class="recommended-list">
        ${obtenerRecomendados(productId, productos)}
      </div>
    </div>
  </form>
</div>`;
}

function setupOptionGroup(groupId) {
  const group = document.getElementById(groupId);
  if (!group) return () => "";
  const buttons = group.querySelectorAll(".option-button");
  let selectedValue = "";

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      buttons.forEach((b) => b.classList.remove("selected"));
      btn.classList.add("selected");
      selectedValue = btn.dataset.value;
    });
  });

  return () => selectedValue;
}

const getSelectedConf = setupOptionGroup("conjunto");
const getSelectedSudadera = setupOptionGroup("sudadera");
const getSelectedChandal = setupOptionGroup("chandal");
const getSelectedAbrigo = setupOptionGroup("abrigo");
const getSelectedChubasquero = setupOptionGroup("chubasquero");
const getSelectedMedias = setupOptionGroup("medias");
const getSelectedRopa_Juego = setupOptionGroup("ropa-juego");
const selectedMedias = setupOptionGroup("medias-options");
const getSelectedSize = setupOptionGroup("size-options");

function getCart() {
  const cartJSON = localStorage.getItem("cart");
  return cartJSON ? JSON.parse(cartJSON) : [];
}

function saveCart(cart) {
  localStorage.setItem("cart", JSON.stringify(cart));
}

document
  .getElementById("product-options-form")
  .addEventListener("submit", (e) => {
    e.preventDefault();
    const p = productos[productId];

    const talla = getSelectedSize();
    const cantidad = parseInt(
      document.getElementById("quantity-input").value,
      10
    );

    const requiredSelections = [
      { label: "el conjunto", getter: getSelectedConf },
      { label: "la sudadera", getter: getSelectedSudadera },
      { label: "el chándal", getter: getSelectedChandal },
      { label: "el abrigo", getter: getSelectedAbrigo },
      { label: "el chubasquero", getter: getSelectedChubasquero },
      { label: "las medias", getter: getSelectedMedias },
      { label: "la ropa de juego", getter: getSelectedRopa_Juego },
    ];

    if (productId === "413844522") {
      for (const { label, getter } of requiredSelections) {
        if (!getter()) {
          showMessage(`Por favor, selecciona todos los campos.`);
          return;
        }
      }
    }

    if (p.tallas.length && !talla && productId !== "413844522") {
      showMessage("Por favor, selecciona una talla.");
      return;
    }

    let nombreUsuario = "";
    let dorsalUsuario = "";
    if (productId === "413844533") {
      nombreUsuario = document.getElementById("name-input").value.trim();
      dorsalUsuario = document.getElementById("number-input").value.trim();
      if (!nombreUsuario || !dorsalUsuario) {
        showMessage("Por favor, introduce un nombre y dorsal.");
        return;
      }
    }

    if (productId === "413844539") {
      if (!getSelectedMedias()) {
        showMessage("Por favor, selecciona una talla de medias.");
        return;
      }
    }

    const item = {
      id: productId,
      nombre: p.nombre,
      talla: talla || null,
      cantidad,
      nombreUsuario: nombreUsuario || null,
      dorsalUsuario: dorsalUsuario || null,
      conjunto: getSelectedConf() || null,
      medias: getSelectedMedias() || null,
      sudadera: getSelectedSudadera() || null,
      chandal: getSelectedChandal() || null,
      abrigo: getSelectedAbrigo() || null,
      chubasquero: getSelectedChubasquero() || null,
      ropaJuego: getSelectedRopa_Juego() || null,
      precio: p.precio || 0,
      imagen: p.imagen || "",
    };

    let itemExists = false;
    const cart = getCart();
    cart.forEach((product) => {
      if (product.id === item.id && product.talla === item.talla) {
        product.cantidad += cantidad;
        itemExists = true;
        return;
      }
    });
    if (!itemExists) {
      cart.push(item);
    }
    saveCart(cart);

    window.location.href = "mercha.html";
  });

window.addEventListener("scroll", () => {
  const header = document.getElementById("fixedHeader");
  if (window.scrollY > 50) {
    header.classList.add("scrolled");
  } else {
    header.classList.remove("scrolled");
  }
});

function showMessage(text, type = "error", duration = 4000) {
  const container = document.getElementById("message-container");
  if (!container) return;

  const message = document.createElement("div");
  message.className = `message ${type}`;
  message.textContent = text;

  const closeBtn = document.createElement("button");
  closeBtn.textContent = "×";
  closeBtn.className = "close-btn";
  closeBtn.onclick = () => container.removeChild(message);
  message.appendChild(closeBtn);

  container.appendChild(message);

  setTimeout(() => {
    if (container.contains(message)) {
      container.removeChild(message);
    }
  }, duration);
}

window.addEventListener("load", () => {
  const img = document.querySelector(".product-image");
  if (!img) return;

  const lens = document.createElement("div");
  lens.classList.add("zoom-lens");
  document.body.appendChild(lens);

  img.style.position = "relative";

  img.addEventListener("mousemove", (e) => {
    lens.style.display = "block";

    const rect = img.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const lensWidth = lens.offsetWidth / 2;
    const lensHeight = lens.offsetHeight / 2;
    let lensX = e.pageX - lensWidth;
    let lensY = e.pageY - lensHeight;

    if (x < 0 || y < 0 || x > rect.width || y > rect.height) {
      lens.style.display = "none";
      return;
    }

    lens.style.left = `${lensX}px`;
    lens.style.top = `${lensY}px`;

    lens.style.backgroundImage = `url('${img.src}')`;

    const bgX = (x / rect.width) * 100;
    const bgY = (y / rect.height) * 100;

    lens.style.backgroundPosition = `${bgX}% ${bgY}%`;
  });

  img.addEventListener("mouseleave", () => {
    lens.style.display = "none";
  });
});

window.addEventListener("load", () => {
  const images = Array.from(document.querySelectorAll(".product-image"));
  if (images.length === 0) return;

  let currentIndex = 0;

  const overlay = document.createElement("div");
  overlay.classList.add("fullscreen-overlay");
  overlay.style.display = "none";

  const fullscreenImg = document.createElement("img");
  overlay.appendChild(fullscreenImg);

  const closeBtn = document.createElement("button");
  closeBtn.classList.add("fullscreen-close-btn");
  closeBtn.textContent = "×";
  closeBtn.style.display = "none";

  document.body.appendChild(overlay);
  document.body.appendChild(closeBtn);

  function updateImage() {
    fullscreenImg.src = images[currentIndex].src;
  }

  images.forEach((img, i) => {
    img.style.cursor = "pointer";
    img.addEventListener("click", () => {
      currentIndex = i;
      updateImage();
      overlay.style.display = "flex";
      closeBtn.style.display = "block";
      prevBtn.style.display = "block";
      nextBtn.style.display = "block";
      document.body.style.overflow = "hidden";
    });
  });

  closeBtn.addEventListener("click", () => {
    overlay.style.display = "none";
    closeBtn.style.display = "none";
    prevBtn.style.display = "none";
    nextBtn.style.display = "none";
    document.body.style.overflow = "";
  });

  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) {
      overlay.style.display = "none";
      closeBtn.style.display = "none";
      prevBtn.style.display = "none";
      nextBtn.style.display = "none";
      document.body.style.overflow = "";
    }
  });
});

const p = productos[productId];

const images = p.imagen;
let currentIndex = 0;

const carouselImage = document.getElementById("carousel-image");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");

prevBtn.addEventListener("click", () => {
  currentIndex = (currentIndex - 1 + images.length) % images.length;
  carouselImage.src = images[currentIndex];
});

nextBtn.addEventListener("click", () => {
  currentIndex = (currentIndex + 1) % images.length;
  carouselImage.src = images[currentIndex];
});

const otrasImagenes = document.getElementById("otrasImagenes");

for (let i = 0; i < p.imagen.length; i++) {
  const card = document.createElement("div");
  card.className = "image-card";

  const img = document.createElement("img");
  img.src = p.imagen[i];
  img.alt = p.nombre;
  img.style.width = "100%";
  img.style.borderRadius = "8px";

  const title = document.createElement("p");
  title.style.textAlign = "center";
  title.style.marginTop = "0.5rem";
  title.style.fontSize = "0.9rem";
  title.style.color = "#444";

  card.appendChild(img);
  card.appendChild(title);
  otrasImagenes.appendChild(card);
}

document.addEventListener("DOMContentLoaded", () => {
  const carouselImage = document.getElementById("carousel-image");
  const photosCard = document.getElementById("otrasImagenes");
  const prevBtn = document.getElementById("prev-btn");
  const nextBtn = document.getElementById("next-btn");

  const cards = Array.from(photosCard.querySelectorAll(".image-card"));

  let currentIndex = 0;

  function updateCarousel(index) {
    if (index < 0) index = cards.length - 1;
    if (index >= cards.length) index = 0;
    currentIndex = index;

    const img = cards[currentIndex].querySelector("img");
    carouselImage.src = img.src;
    carouselImage.alt = img.alt || "";

    cards.forEach((card) => card.classList.remove("selected"));
    cards[currentIndex].classList.add("selected");
  }

  photosCard.addEventListener("click", (e) => {
    const card = e.target.closest(".image-card");
    if (!card) return;

    const clickedIndex = cards.indexOf(card);
    if (clickedIndex !== -1) {
      updateCarousel(clickedIndex);
    }
  });

  prevBtn.addEventListener("click", () => updateCarousel(currentIndex - 1));
  nextBtn.addEventListener("click", () => updateCarousel(currentIndex + 1));

  updateCarousel(0);
});
